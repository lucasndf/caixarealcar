<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Real Car - Sistema de Caixa (Login Visual)</title>
<style>
  :root{
    --fundo:#1e1e1e; --painel:#2a2a2a; --borda:#444; --campo:#333;
    --vermelho:#d62828; --texto:#f8f9fa; --ok:#6ee7a8; --bad:#fca5a5; --warn:#facc15;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--fundo);color:var(--texto);font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif}
  .login-container{display:flex;justify-content:center;align-items:center;height:100vh;background:#111;flex-direction:column;padding:16px}
  .login-box{background:var(--painel);padding:28px;border-radius:12px;box-shadow:0 0 12px #000;width:320px;max-width:100%;text-align:center}
  .login-box h1{margin:0 0 6px;color:var(--vermelho)}
  .login-box p{margin:0 0 18px;color:#ccc}
  .login-box input{width:100%;padding:10px;margin-bottom:12px;border:none;border-radius:6px;background:#333;color:#fff}
  .login-box button{width:100%;padding:11px;background:var(--vermelho);color:#fff;border:none;border-radius:6px;font-weight:700;cursor:pointer}
  .erro{color:#f87171;margin-top:8px;min-height:20px}
  .container{display:none;max-width:1200px;margin:auto;padding:26px 18px}
  .bloco{background:var(--painel);border-radius:12px;padding:22px;margin-bottom:24px;box-shadow:0 0 10px #00000088}
  .bloco h2{margin:0 0 12px;color:var(--vermelho);border-bottom:1px solid var(--borda);padding-bottom:8px}
  label{display:block;margin-top:10px;font-weight:600}
  input,select{width:100%;padding:10px;border-radius:6px;border:1px solid #555;background:var(--campo);color:#fff;font-size:15px}
  .form-grid{display:flex;gap:14px;flex-wrap:wrap}
  .form-grid>div{flex:1;min-width:200px}
  button{padding:10px 14px;border:none;border-radius:6px;background:var(--vermelho);color:#fff;font-weight:700;cursor:pointer}
  .secondary{background:#444}
  .danger{background:#7a0b0b}
  table{width:100%;border-collapse:collapse;margin-top:12px}
  th,td{padding:9px;border-bottom:1px solid #3a3a3a;font-size:14px;text-align:left}
  th{color:#d0d0d0}
  .summary{display:flex;gap:12px;flex-wrap:wrap;margin-top:12px}
  .pill{flex:1;min-width:160px;background:#111;border-radius:10px;padding:10px 12px;text-align:center}
  .pill b{display:block;color:#bbb;margin-bottom:4px}
  .ok{color:var(--ok)} .bad{color:var(--bad)} .neutral{color:var(--warn)}
  .toolbar{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px;align-items:center}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginTela" class="login-container">
  <div class="login-box">
    <h1>Real Car</h1>
    <p>Sistema de Caixa</p>
    <input id="usuario" type="text" placeholder="Usu√°rio" autocomplete="off">
    <input id="senha" type="password" placeholder="Senha">
    <button onclick="fazerLogin()">Entrar</button>
    <div id="erroLogin" class="erro"></div>
  </div>
</div>

<!-- APP -->
<div id="app" class="container">
  <!-- Entradas / Sa√≠das -->
  <div class="bloco">
    <h2>Entradas</h2>
    <div class="form-grid">
      <div><label>Data</label><input id="dataEntrada" type="date"></div>
      <div><label>Descri√ß√£o</label><input id="clienteEntrada" type="text" placeholder="Ex: Jo√£o - Celta prata (ABC1D23) - Dianteiro + Servi√ßo"></div>
      <div><label>Tipo</label>
        
<select id="tipoEntrada">
  <option>Dianteiro</option>
  <option>Traseiro</option>
  <option>Dianteiro + Traseiro</option>
  <option>Dianteiro + Traseiro + Servi√ßo</option>
  <option>Servi√ßo</option>
  <option>Ferro Velho</option>
  <option>Hastes</option>
</select>

      
      <div id="divServico" style="display:none">
        <label>Descri√ß√£o do Servi√ßo</label>
        <input id="descricaoServico" type="text" placeholder="Ex: Troca de coxim, alinhamento...">
      </div>
</div>
      <div><label>Qtd</label><input id="qtdEntrada" type="number" value="1" min="1"></div>
      <div><label>Forma</label>
        <select id="formaEntrada"><option>Pix</option><option>Cart√£o</option><option>Dinheiro</option></select>
      </div>
      <div><label>Valor (R$)</label><input id="valorEntrada" type="number" step="0.01"></div>
    </div>
    <div class="toolbar"><button onclick="adicionarEntrada()">+ Adicionar Entrada</button></div>
    <table id="tabelaEntradas"><thead>
      <tr><th>Data</th><th>Cliente</th><th>Tipo</th><th>Qtd</th><th>Forma</th><th>Valor</th><th>A√ß√µes</th></tr>
    </thead><tbody></tbody></table>
  </div>

  <div class="bloco">
    <h2>Sa√≠das</h2>
    <div class="form-grid">
      <div><label>Data</label><input id="dataSaida" type="date"></div>
      <div><label>Descri√ß√£o</label><input id="descricaoSaida" type="text"></div>
      <div><label>Categoria</label>
        
<select id="categoriaSaida">
  <option>Alimenta√ß√£o</option>
  <option>Compra de Carca√ßa</option>
  <option>Disco do Esmeril</option>
  <option>Ferramentas</option>
  <option>√ìrg√¥nio/Nitrog√™nio</option>
  <option>Outros</option>
  <option>Pe√ßas</option>
  <option>Supermercado</option>
  <option>Tinta e Tinner</option>
  <option>Transporte</option>
  <option>Vareta de Solda</option>
</select>

      </div>
      <div><label>Valor (R$)</label><input id="valorSaida" type="number" step="0.01"></div>
    </div>
    <div class="toolbar"><button onclick="adicionarSaida()">+ Adicionar Sa√≠da</button></div>
    <table id="tabelaSaidas"><thead>
      <tr><th>Data</th><th>Descri√ß√£o</th><th>Categoria</th><th>Valor</th><th>A√ß√µes</th></tr>
    </thead><tbody></tbody></table>
  </div>

  <!-- Filtros e Resumo -->
  <div class="bloco">
    <h2>Filtros e Resumo</h2>
    <div class="form-grid">
      <div><label>Buscar</label><input id="campoBusca" type="text" placeholder="üîç nome, tipo, forma..." oninput="atualizarTabelas()"></div>
      <div><label>Filtro por Dia</label><input id="filtroDia" type="date" onchange="atualizarTabelas()"></div>
      <div><label>Filtro por M√™s</label><input id="filtroMes" type="month" onchange="atualizarTabelas()"></div>
    </div>
    <div class="summary">
      <div class="pill"><b>Total Entradas</b><span id="totalEntradas" class="ok">R$ 0,00</span></div>
      <div class="pill"><b>Total Sa√≠das</b><span id="totalSaidas" class="bad">R$ 0,00</span></div>
      <div class="pill"><b>Saldo</b><span id="saldo" class="neutral">R$ 0,00</span></div>
      <div class="pill"><b>PIX</b><span id="totalPix">R$ 0,00</span></div>
      <div class="pill"><b>Cart√£o</b><span id="totalCartao">R$ 0,00</span></div>
      <div class="pill"><b>Dinheiro</b><span id="totalDinheiro">R$ 0,00</span></div>
    </div>
  </div>

  <!-- Backup e Relat√≥rios -->
  <div class="bloco">
    <h2>Backup e Relat√≥rios</h2>
    <div class="toolbar">
      <button class="secondary" onclick="limparFiltros()">üßπ Limpar Filtros</button>
      <button class="secondary" onclick="exportarCSV()">üìÅ Exportar CSV</button>
      <button class="secondary" onclick="exportarJSON()">üíæ Exportar Backup</button>
      <input id="importJSON" type="file" accept=".json" onchange="importarJSON(event)">
      <button class="secondary" onclick="imprimirRelatorio()">üñ®Ô∏è Imprimir Relat√≥rio</button>
      <button class="secondary" onclick="fecharMes()">üìÖ Fechar M√™s</button>
      <button class="danger" onclick="apagarTudo()">üóëÔ∏è Apagar TODOS os dados</button>
    </div>
  </div>
</div>

<div id="printArea" style="display:none"></div>

<script>
  // ====== Login visual ======
  const usuarioPadrao="admin", senhaPadrao="12345";
  function fazerLogin(){
    const u=document.getElementById('usuario').value.trim();
    const s=document.getElementById('senha').value.trim();
    const msg=document.getElementById('erroLogin');
    if(u===usuarioPadrao && s===senhaPadrao){
      msg.textContent="";
      document.getElementById('loginTela').style.display='none';
      document.getElementById('app').style.display='block';
      init();
    }else{
      msg.textContent="Usu√°rio ou senha incorretos!";
    }
  }

  // ====== Estado & Storage ======
  const LS_KEY='realcar_caixa_v3_visual';
  let entradas=[], saidas=[];

  function salvar(){ localStorage.setItem(LS_KEY, JSON.stringify({entradas,saidas})); }
  function carregar(){
    try{
      const raw=localStorage.getItem(LS_KEY);
      if(!raw) return;
      const data=JSON.parse(raw);
      entradas = Array.isArray(data.entradas)? data.entradas:[];
      saidas   = Array.isArray(data.saidas)?   data.saidas  :[];
    }catch(e){}
  }

  // ====== Utils ======
  const hojeISO = ()=> new Date().toLocaleDateString('fr-CA');
  const BRL = v => parseFloat(v||0).toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
  const esc = s => String(s??"").replace(/[&<>"']/g, m=>({ "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;" }[m]));

  // ====== Init ======
  
function init(){
  document.getElementById("tipoEntrada").addEventListener("change", () => {
    const tipo = document.getElementById("tipoEntrada").value;
    document.getElementById("divServico").style.display = (tipo === "Servi√ßo" || tipo === "Dianteiro + Traseiro + Servi√ßo") ? "block" : "none";
  });

    document.getElementById('dataEntrada').value = hojeISO();
    document.getElementById('dataSaida').value   = hojeISO();
    carregar(); atualizarTabelas();
  }

  // ====== Filtros/Busca ======
  function filtroAtivo(dataISO){
    const dia=document.getElementById('filtroDia').value;
    const mes=document.getElementById('filtroMes').value;
    if(dia) return dataISO===dia;
    if(mes) return dataISO.startsWith(mes);
    return true;
  }
  function atendeBuscaEntrada(e,q){
    const s=(q||'').toLowerCase();
    return (e.cliente||'').toLowerCase().includes(s) ||
           (e.tipo||'').toLowerCase().includes(s) ||
           (e.forma||'').toLowerCase().includes(s);
  }
  function atendeBuscaSaida(x,q){
    const s=(q||'').toLowerCase();
    return (x.descricao||'').toLowerCase().includes(s) ||
           (x.categoria||'').toLowerCase().includes(s);
  }

  // ====== CRUD Entradas ======
  function adicionarEntrada(){
    const e={
      id:crypto.randomUUID(),
      data: document.getElementById('dataEntrada').value || hojeISO(),
      cliente: (document.getElementById('clienteEntrada').value||'').trim(),
      tipo: document.getElementById('tipoEntrada').value,
      qtd: parseInt(document.getElementById('qtdEntrada').value||'1',10),
      forma: document.getElementById('formaEntrada').value,
      
valor: parseFloat(String(document.getElementById('valorEntrada').value).replace(',','.')),
descricao: ['Servi√ßo', 'Dianteiro + Traseiro + Servi√ßo'].includes(document.getElementById('tipoEntrada').value) ? document.getElementById('descricaoServico').value.trim() : ''

    };
    if(!e.cliente || isNaN(e.valor) || e.valor<=0){ alert('Preencha cliente e valor v√°lido.'); return; }
    entradas.push(e); salvar();
    document.getElementById('clienteEntrada').value='';
    document.getElementById('qtdEntrada').value='1';
    
document.getElementById('valorEntrada').value='';
document.getElementById('descricaoServico').value='';
document.getElementById('divServico').style.display='none';

    atualizarTabelas();
  }
  function editarEntrada(id){
    const e=entradas.find(x=>x.id===id); if(!e) return;
    const cliente=prompt('Cliente/Carro:', e.cliente); if(cliente===null) return;
    const tipo=prompt('Tipo:', e.tipo); if(tipo===null) return;
    const qtd=prompt('Quantidade:', e.qtd); if(qtd===null||isNaN(parseInt(qtd))) return;
    const forma=prompt('Forma (Pix/Cart√£o/Dinheiro):', e.forma); if(forma===null) return;
    const valor=prompt('Valor (R$):', e.valor); if(valor===null||isNaN(parseFloat(valor))) return;
    e.cliente=cliente.trim(); e.tipo=tipo; e.qtd=parseInt(qtd,10); e.forma=forma; e.valor=parseFloat(String(valor).replace(',','.'));
    salvar(); atualizarTabelas();
  }
  function excluirEntrada(id){
    if(!confirm('Excluir esta entrada?')) return;
    entradas=entradas.filter(x=>x.id!==id); salvar(); atualizarTabelas();
  }

  // ====== CRUD Sa√≠das ======
  function adicionarSaida(){
    const s={
      id:crypto.randomUUID(),
      data: document.getElementById('dataSaida').value || hojeISO(),
      descricao: (document.getElementById('descricaoSaida').value||'').trim(),
      categoria: document.getElementById('categoriaSaida').value,
      valor: parseFloat(String(document.getElementById('valorSaida').value).replace(',','.'))
    };
    if(!s.descricao || isNaN(s.valor) || s.valor<=0){ alert('Preencha descri√ß√£o e valor v√°lido.'); return; }
    saidas.push(s); salvar();
    document.getElementById('descricaoSaida').value='';
    document.getElementById('valorSaida').value='';
    atualizarTabelas();
  }
  function editarSaida(id){
    const s=saidas.find(x=>x.id===id); if(!s) return;
    const desc=prompt('Descri√ß√£o:', s.descricao); if(desc===null) return;
    const cat=prompt('Categoria:', s.categoria); if(cat===null) return;
    const val=prompt('Valor (R$):', s.valor); if(val===null||isNaN(parseFloat(val))) return;
    s.descricao=desc.trim(); s.categoria=cat; s.valor=parseFloat(String(val).replace(',','.'));
    salvar(); atualizarTabelas();
  }
  function excluirSaida(id){
    if(!confirm('Excluir esta sa√≠da?')) return;
    saidas=saidas.filter(x=>x.id!==id); salvar(); atualizarTabelas();
  }

  // ====== Render ======
  function atualizarTabelas(){
    const busca=document.getElementById('campoBusca').value||'';

    const ent=entradas.filter(e=>filtroAtivo(e.data))
                      .filter(e=>!busca || atendeBuscaEntrada(e,busca))
                      .sort((a,b)=>a.data.localeCompare(b.data));
    const sai=saidas.filter(s=>filtroAtivo(s.data))
                    .filter(s=>!busca || atendeBuscaSaida(s,busca))
                    .sort((a,b)=>a.data.localeCompare(b.data));

    // Entradas
    const te=document.querySelector('#tabelaEntradas tbody');
    te.innerHTML=ent.map(e=>`
      <tr>
        <td>${esc(e.data)}</td>
        <td>${esc(e.cliente)}</td>
        <td>${esc(e.tipo)+(e.descricao ? ' - '+esc(e.descricao) : '')}</td>
        <td>${e.qtd||1}</td>
        <td>${esc(e.forma)}</td>
        <td>${BRL(e.valor)}</td>
        <td>
          <button class="secondary" onclick="editarEntrada('${e.id}')">‚úèÔ∏è</button>
          <button class="danger" onclick="excluirEntrada('${e.id}')">üóëÔ∏è</button>
        </td>
      </tr>`).join('');

    // Sa√≠das
    const ts=document.querySelector('#tabelaSaidas tbody');
    ts.innerHTML=sai.map(s=>`
      <tr>
        <td>${esc(s.data)}</td>
        <td>${esc(s.descricao)}</td>
        <td>${esc(s.categoria)}</td>
        <td>${BRL(s.valor)}</td>
        <td>
          <button class="secondary" onclick="editarSaida('${s.id}')">‚úèÔ∏è</button>
          <button class="danger" onclick="excluirSaida('${s.id}')">üóëÔ∏è</button>
        </td>
      </tr>`).join('');

    // Totais
    const totE=ent.reduce((acc,e)=>acc+e.valor,0);
    const totS=sai.reduce((acc,s)=>acc+s.valor,0);
    document.getElementById('totalEntradas').textContent=BRL(totE);
    document.getElementById('totalSaidas').textContent=BRL(totS);
    const saldoEl=document.getElementById('saldo');
    saldoEl.textContent=BRL(totE-totS);
    saldoEl.style.color=(totE-totS)>=0? 'var(--ok)':'var(--bad)';

    const pix=ent.filter(e=>e.forma==='Pix').reduce((s,e)=>s+e.valor,0);
    const cartao=ent.filter(e=>e.forma==='Cart√£o').reduce((s,e)=>s+e.valor,0);
    const dinheiro=ent.filter(e=>e.forma==='Dinheiro').reduce((s,e)=>s+e.valor,0);
    document.getElementById('totalPix').textContent=BRL(pix);
    document.getElementById('totalCartao').textContent=BRL(cartao);
    document.getElementById('totalDinheiro').textContent=BRL(dinheiro);
  }

  function limparFiltros(){
    document.getElementById('campoBusca').value='';
    document.getElementById('filtroDia').value='';
    document.getElementById('filtroMes').value='';
    atualizarTabelas();
  }

  // ====== Exporta√ß√µes / Backup ======
  function exportarCSV(){
    const dia=document.getElementById('filtroDia').value;
    const mes=document.getElementById('filtroMes').value;
    const busca=document.getElementById('campoBusca').value||'';
    const filtra = d => (dia? d===dia : (mes? d.startsWith(mes) : true));

    const ent=entradas.filter(e=>filtra(e.data)&&(!busca||atendeBuscaEntrada(e,busca)));
    const sai=saidas.filter(s=>filtra(s.data)&&(!busca||atendeBuscaSaida(s,busca)));

    let csv='Tipo,Data,Descri√ß√£o,Detalhes,Valor\n';
    ent.forEach(e=> csv+=`Entrada,${e.data},${csvEsc(e.cliente)},${csvEsc(e.tipo)} (${e.forma}),${e.valor}\n`);
    sai.forEach(s=> csv+=`Sa√≠da,${s.data},${csvEsc(s.descricao)},${csvEsc(s.categoria)},${s.valor}\n`);

    const blob=new Blob(["\uFEFF"+csv],{type:'text/csv;charset=utf-8;'});
    const a=document.createElement('a');
    a.href=URL.createObjectURL(blob);
    a.download= dia? `realcar_${dia}.csv` : (mes? `realcar_${mes}.csv` : 'realcar_todos.csv');
    a.click(); URL.revokeObjectURL(a.href);
  }
  function csvEsc(s){ if(s==null) return ''; s=String(s); return /[,";\n]/.test(s)? `"${s.replace(/"/g,'""')}"` : s; }

  function exportarJSON(){
    const blob=new Blob([JSON.stringify({entradas,saidas},null,2)],{type:'application/json'});
    const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='realcar_backup.json'; a.click();
  }
  function importarJSON(ev){
    const file=ev.target.files[0]; if(!file) return;
    const r=new FileReader();
    r.onload=e=>{ try{
        const d=JSON.parse(e.target.result);
        entradas=Array.isArray(d.entradas)?d.entradas:[]; saidas=Array.isArray(d.saidas)?d.saidas:[];
        salvar(); atualizarTabelas(); alert('Backup importado!');
      }catch(err){ alert('Arquivo inv√°lido.'); } };
    r.readAsText(file);
  }

  // ====== Relat√≥rios ======
  function imprimirRelatorio(){
    const dia=document.getElementById('filtroDia').value;
    const mes=document.getElementById('filtroMes').value;
    const busca=document.getElementById('campoBusca').value||'';
    const filtra = d => (dia? d===dia : (mes? d.startsWith(mes) : true));

    const ent=entradas.filter(e=>filtra(e.data)&&(!busca||atendeBuscaEntrada(e,busca)));
    const sai=saidas.filter(s=>filtra(s.data)&&(!busca||atendeBuscaSaida(s,busca)));

    const totE=ent.reduce((a,e)=>a+e.valor,0);
    const totS=sai.reduce((a,e)=>a+e.valor,0);

    const area=document.getElementById('printArea');
    const titulo= dia? `Relat√≥rio do dia ${dia}` : (mes? `Relat√≥rio do m√™s ${mes}` : 'Relat√≥rio geral');
    area.innerHTML=`
      <div style="font-family:Arial;color:#000;width:720px;margin:auto">
        <h2 style="margin:6px 0">üìÑ ${titulo} ‚Äì Real Car Amortecedores</h2><hr/>
        <h3>Entradas</h3>
        <ul>${ent.map(e=>`<li>${e.data} ‚Äì ${esc(e.cliente)} (${esc(e.tipo)+(e.descricao ? ' - '+esc(e.descricao) : '')}, ${esc(e.forma)}) ‚Äì ${BRL(e.valor)}</li>`).join('')}</ul>
        <h3>Sa√≠das</h3>
        <ul>${sai.map(s=>`<li>${s.data} ‚Äì ${esc(s.descricao)} (${esc(s.categoria)}) ‚Äì ${BRL(s.valor)}</li>`).join('')}</ul>
        <hr/><p><b>Total Entradas:</b> ${BRL(totE)}<br><b>Total Sa√≠das:</b> ${BRL(totS)}<br><b>Saldo:</b> ${BRL(totE-totS)}</p>
      </div>`;
    setTimeout(()=>window.print(),100);
  }

  function fecharMes(){
    const mes=document.getElementById('filtroMes').value || new Date().toISOString().slice(0,7);
    const ent=entradas.filter(e=>e.data.startsWith(mes));
    const sai=saidas.filter(s=>s.data.startsWith(mes));
    const totE=ent.reduce((a,e)=>a+e.valor,0);
    const totS=sai.reduce((a,e)=>a+e.valor,0);
    alert(`üìÖ Fechamento ${mes}\nEntradas: ${BRL(totE)}\nSa√≠das: ${BRL(totS)}\nSaldo: ${BRL(totE-totS)}`);
  }

  function apagarTudo(){
  const senha = prompt("Digite a senha para confirmar:");
  if (senha !== senhaPadrao) {
    alert("‚ùå Senha incorreta!");
    return;
  }

    if(!confirm('Tem certeza que deseja apagar TODOS os dados?')) return;
    entradas=[]; saidas=[]; salvar(); atualizarTabelas();
  }
</script>
</body>
</html>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const senhaInput = document.getElementById('senha');
    if (senhaInput) {
      senhaInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') fazerLogin();
      });
    }
  });
</script>
